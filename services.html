<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Services</title>

  <style>
    :root{
      --radius-lg: 26px;
      --radius-md: 18px;
      --stroke: 3px;

      --bg: #000;
      --topbar: rgba(255,255,255,.10);

      --text: #eaffff;
      --muted: rgba(255,255,255,.72);

      --accent: #b9ff1f;     /* neon lime */
      --blue: #1aa7ff;

      --card: rgba(255,255,255,.06);
      --card2: rgba(255,255,255,.03);

      --shadow: rgba(0,0,0,.70);
      --btn: rgba(255,255,255,.06);
    }

    *{ box-sizing: border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(1100px 600px at 70% 10%, rgba(26,167,255,.10), transparent 55%),
        radial-gradient(900px 520px at 15% 80%, rgba(185,255,31,.08), transparent 60%),
        var(--bg);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
    }

    .wrap{
      width: min(1200px, 100%);
      margin: 0 auto;
      padding: 0 18px 60px;
    }

    /* ===== TOP BAR ===== */
    .topbar{
      margin-top: 18px;
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border-radius: 12px;
      padding: 14px 16px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      box-shadow: 0 16px 40px var(--shadow);
      border: 1px solid rgba(255,255,255,.10);
      backdrop-filter: blur(10px);
      position: sticky;
      top: 10px;
      z-index: 10;
    }

    .chip{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding: 10px 14px;
      border-radius: 14px;
      border: var(--stroke) solid var(--accent);
      color: var(--accent);
      background: linear-gradient(180deg, var(--btn), transparent);
      transition: transform .2s ease, box-shadow .2s ease;
      cursor:pointer;
      font-weight: 900;
      letter-spacing: .2px;
      text-transform: lowercase;
      user-select:none;
    }
    .chip:hover{ transform: translateY(-2px); box-shadow: 0 10px 26px rgba(0,0,0,.35); }

    .right{ display:flex; align-items:center; gap: 10px; }

    .iconPlus{
      width: 40px;
      height: 40px;
      border-radius: 999px;
      border: var(--stroke) solid var(--accent);
      display:grid;
      place-items:center;
      color: var(--accent);
      background: linear-gradient(180deg, var(--btn), transparent);
      transition: transform .2s ease, box-shadow .2s ease;
      cursor:pointer;
      user-select:none;
    }
    .iconPlus:hover{ transform: rotate(8deg) scale(1.02); box-shadow: 0 10px 26px rgba(0,0,0,.35); }
    .iconPlus svg{ width: 18px; height: 18px; }

    /* ===== AVATAR + PROFILE CARD ===== */
    .avatarWrap{ position:relative; }
    .avatarBtn{
      width: 44px;
      height: 44px;
      border-radius: 999px;
      border: var(--stroke) solid var(--accent);
      overflow:hidden;
      display:grid;
      place-items:center;
      background: linear-gradient(180deg, var(--btn), transparent);
      transition: transform .2s ease, box-shadow .2s ease;
      cursor:pointer;
      user-select:none;
      position: relative;
    }
    .avatarBtn:hover{ transform: translateY(-2px); box-shadow: 0 10px 26px rgba(0,0,0,.35); }
    .avatarBtn img{ width:100%; height:100%; object-fit:cover; display:block; }

    /* ‚úÖ White blurred background */
    .profileCard{
      position: absolute;
      top: 64px;
      right: 0;
      width: 310px;
      padding: 12px;
      border-radius: 16px;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      box-shadow: 0 18px 55px rgba(0,0,0,.55);
      transform: translateY(8px);
      opacity: 0;
      pointer-events: none;
      transition: opacity .18s ease, transform .18s ease;
      z-index: 20;

      background: rgba(255,255,255,.78);
      border: 1px solid rgba(0,0,0,.10);
      color: #0b1220;
    }
    .profileCard.show{ opacity:1; transform: translateY(0); pointer-events:auto; }

    .profileTop{ display:flex; gap:10px; align-items:center; }
    .profileTop img{
      width: 44px; height: 44px;
      border-radius: 999px;
      object-fit: cover;
      border: 2px solid rgba(185,255,31,.9);
    }
    .profileName{ font-weight: 1000; }
    .profileSub{ font-size: 12px; opacity: .75; margin-top: 2px; }

    .profileInfo{
      margin-top: 10px;
      font-size: 13px;
      line-height: 1.35;
      opacity: .95;
      color: #0b1220;
    }
    .profileInfo b{ color: #0b1220; }

    .profileActions{
      display:flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap; /* ‚úÖ allow 3 buttons on small screens without breaking */
    }
    .miniBtn{
      flex: 1;
      padding: 10px 10px;
      border-radius: 14px;
      border: 2px solid rgba(0,0,0,.12);
      background: rgba(0,0,0,.04);
      color: #0b1220;
      font-weight: 1000;
      cursor:pointer;
      text-align:center;
      user-select:none;
      min-width: 120px;
    }
    .miniBtn.primary{
      border: var(--stroke) solid rgba(185,255,31,.9);
      background: rgba(185,255,31,.18);
    }

    /* ===== CARDS ===== */
    .cards{
      margin-top: 34px;
      display:flex;
      gap: 26px;
      justify-content: center;
      align-items: flex-start;
      flex-wrap: wrap;
    }

    .tile{
      width: min(340px, 92vw);
      border-radius: var(--radius-lg);
      padding: 18px;
      background: linear-gradient(180deg, var(--card), var(--card2));
      border: 4px solid rgba(26,167,255,.70);
      box-shadow: 0 22px 60px rgba(0,0,0,.55);
      overflow: hidden;
      transform: translateY(10px);
      opacity: 0;
      animation: popIn .55s ease forwards;
      transition: transform .2s ease, box-shadow .2s ease, border-color .2s ease;
    }
    .tile:nth-child(2){ animation-delay: .08s; }
    .tile:nth-child(3){ animation-delay: .16s; }
    @keyframes popIn{ to{ transform: translateY(0); opacity:1; } }

    .tileBtn{
      all: unset;
      cursor: default;
      display:flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 14px;
      width: 100%;
    }

    .inner{
      width: 100%;
      height: 170px;
      border-radius: 22px;
      border: var(--stroke) solid var(--accent);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      padding: 80px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      color: var(--accent);
      transition: transform .25s ease;
    }
    .title{
      max-width: 100%;
      font-size: 22px;
      font-weight: 1000;
      line-height: 1.15;
      text-transform: lowercase;
      word-break: break-word;
      margin: 0;
    }

    .tile:hover{
      border-color: rgba(26,167,255,.95);
      box-shadow: 0 26px 70px rgba(0,0,0,.70), 0 0 0 1px rgba(26,167,255,.25) inset;
      transform: translateY(-2px);
    }
    .tile:hover .inner{ transform: translateY(-3px); }

    /* ‚úÖ purchase by clicking price button only */
    .priceBtn{
      cursor: pointer;
      padding: 10px 14px;
      border-radius: 14px;
      border: var(--stroke) solid var(--accent);
      color: var(--accent);
      font-weight: 1000;
      letter-spacing: .3px;
      text-align:center;
      min-width: 160px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), transparent);
      user-select:none;
      transition: transform .15s ease, box-shadow .2s ease;
    }
    .priceBtn:hover{
      transform: translateY(-1px);
      box-shadow: 0 10px 26px rgba(0,0,0,.35);
    }

    .sub{
      text-align:center;
      font-size: 13px;
      color: var(--muted);
      opacity: .95;
      max-width: 95%;
    }

    /* ===== SETTINGS PAGE (MODAL) ===== */
    .backdrop{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.55);
      opacity: 0;
      pointer-events: none;
      transition: opacity .18s ease;
      z-index: 50;
    }
    .backdrop.show{ opacity: 1; pointer-events:auto; }

    .settings{
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -48%) scale(.98);
      width: min(860px, 94vw);
      max-height: min(80vh, 900px);
      overflow: auto;
      border-radius: 18px;
      padding: 16px;
      opacity: 0;
      pointer-events: none;
      transition: opacity .18s ease, transform .18s ease;
      z-index: 60;

      background: rgba(0,0,0,.65);
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 26px 80px rgba(0,0,0,.70);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    .settings.show{
      opacity: 1;
      pointer-events:auto;
      transform: translate(-50%, -50%) scale(1);
    }

    .settingsHead{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 12px;
    }
    .settingsTitle{
      font-weight: 1000;
      letter-spacing: .2px;
      color: var(--text);
    }
    .closeBtn{
      all: unset;
      cursor:pointer;
      width: 38px;
      height: 38px;
      border-radius: 14px;
      display:grid;
      place-items:center;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      user-select:none;
    }

    .tabs{
      display:flex;
      gap:10px;
      flex-wrap: wrap;
      margin: 12px 0 14px;
    }
    .tab{
      all: unset;
      cursor:pointer;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      font-weight: 900;
      color: var(--text);
      user-select:none;
    }
    .tab.active{
      border: var(--stroke) solid var(--accent);
      color: var(--accent);
      background: linear-gradient(180deg, rgba(255,255,255,.08), transparent);
    }

    .panel{ display:none; }
    .panel.show{ display:block; }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 760px){ .grid2{ grid-template-columns: 1fr; } }

    .cardBox{
      border-radius: 16px;
      padding: 12px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      color: var(--text);
    }

    label{ display:block; font-size: 12px; opacity: .8; margin-bottom: 6px; }
    input, select{
      width:100%;
      padding: 10px 12px;
      border-radius: 14px;
      outline:none;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
    }

    .btn{
      all: unset;
      cursor:pointer;
      padding: 10px 12px;
      border-radius: 14px;
      border: var(--stroke) solid var(--accent);
      color: var(--accent);
      background: linear-gradient(180deg, rgba(255,255,255,.06), transparent);
      font-weight: 1000;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      user-select:none;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 900;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
    }
    .pill.completed{ border-color: rgba(0,255,120,.35); }
    .pill.checking{ border-color: rgba(255,210,0,.35); }
    .pill.denied{ border-color: rgba(255,70,70,.35); }

    .txTable{
      width:100%;
      border-collapse: collapse;
      overflow:hidden;
      border-radius: 14px;
    }
    .txTable th, .txTable td{
      text-align:left;
      padding: 10px 10px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      font-size: 13px;
      vertical-align: middle;
      color: var(--text);
    }
    .txTable th{ opacity:.8; font-size:12px; }
    .mutedSmall{ font-size:12px; opacity:.75; }

    /* ===== CONFIRM MODAL (ARE YOU SURE) ===== */
    .confirmBack{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.60);
      opacity: 0;
      pointer-events: none;
      transition: opacity .18s ease;
      z-index: 70;
    }
    .confirmBack.show{ opacity: 1; pointer-events:auto; }

    .confirmBox{
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -48%) scale(.98);
      width: min(520px, 92vw);
      border-radius: 18px;
      padding: 14px;
      opacity: 0;
      pointer-events: none;
      transition: opacity .18s ease, transform .18s ease;
      z-index: 80;

      background: rgba(0,0,0,.72);
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 26px 80px rgba(0,0,0,.70);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      color: var(--text);
    }
    .confirmBox.show{
      opacity: 1;
      pointer-events:auto;
      transform: translate(-50%, -50%) scale(1);
    }
    .confirmTitle{ font-weight: 1000; }
    .confirmText{ margin-top: 8px; font-size: 13px; opacity: .9; line-height:1.35; }
    .confirmActions{
      display:flex;
      gap: 10px;
      margin-top: 12px;
    }
    .btnSecondary{
      all: unset;
      cursor:pointer;
      flex:1;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      font-weight: 1000;
      text-align:center;
      user-select:none;
    }
    .btnPrimary{
      all: unset;
      cursor:pointer;
      flex:1;
      padding: 10px 12px;
      border-radius: 14px;
      border: var(--stroke) solid var(--accent);
      background: rgba(185,255,31,.10);
      color: var(--accent);
      font-weight: 1000;
      text-align:center;
      user-select:none;
    }

    /* ===== DEPOSIT MODAL (Click / Payme) ===== */
    .payGrid{
      display:flex;
      gap:12px;
      margin-top: 14px;
      flex-wrap: wrap;
    }
    .payBtn{
      all: unset;
      cursor:pointer;
      flex: 1;
      min-width: 180px;
      border-radius: 16px;
      padding: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      display:flex;
      align-items:center;
      justify-content: center;
      gap: 12px;
      transition: transform .15s ease, box-shadow .2s ease, border-color .2s ease;
      user-select:none;
    }
    .payBtn:hover{
      transform: translateY(-2px);
      box-shadow: 0 14px 34px rgba(0,0,0,.50);
      border-color: rgba(255,255,255,.22);
    }
    .logoBox{
      width: 46px;
      height: 46px;
      border-radius: 14px;
      display:grid;
      place-items:center;
      background: rgba(255,255,255,.07);
      border: 1px solid rgba(255,255,255,.10);
    }
    .payText{
      display:flex;
      flex-direction: column;
      gap: 3px;
      min-width: 120px;
    }
    .payName{ font-weight: 1000; }
    .payHint{ font-size: 12px; opacity: .75; }
    .payBtn.click{ border-color: rgba(26,167,255,.50); }
    .payBtn.payme{ border-color: rgba(160,110,255,.50); }

    /* ===== TOAST ===== */
    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%) translateY(20px);
      background: rgba(0,0,0,.60);
      border: 1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      color: #fff;
      padding: 10px 14px;
      border-radius: 14px;
      opacity: 0;
      pointer-events: none;
      transition: opacity .2s ease, transform .2s ease;
      max-width: min(760px, 92vw);
      text-align: center;
      font-size: 14px;
      z-index: 90;
    }
    .toast.show{ opacity: 1; transform: translateX(-50%) translateY(0); }

    @media (max-width: 520px){
      .topbar{ padding: 12px 12px; }
      .chip{ padding: 9px 12px; }
      .tile{ width: 92vw; }
      .payBtn{ min-width: 100%; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header class="topbar">
      <div class="chip" id="openSettings" title="Settings">settings</div>

      <div class="right">
        <!-- ‚úÖ PLUS NOW OPENS DEPOSIT METHODS -->
        <div class="iconPlus" id="addFunds" title="Deposit">
          <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
          </svg>
        </div>

        <div class="chip" id="balanceChip" title="Your balance">
          <span>balance</span>
          <strong id="balanceValue" style="color:#fff; font-weight:1000;">0</strong>
        </div>

        <div class="avatarWrap">
          <div class="avatarBtn" id="avatarBtn" title="Profile">
            <img id="avatarImg" alt="avatar"
              src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120'%3E%3Crect width='120' height='120' rx='60' fill='%231aa7ff'/%3E%3Ctext x='50%25' y='56%25' text-anchor='middle' font-family='Arial' font-size='44' fill='%23b9ff1f' font-weight='800'%3EA%3C/text%3E%3C/svg%3E" />
          </div>

          <div class="profileCard" id="profileCard">
            <div class="profileTop">
              <img id="profileImg" alt="avatar small" />
              <div>
                <div class="profileName" id="profileName">User</div>
                <div class="profileSub" id="profileSub">English learner</div>
              </div>
            </div>

            <div class="profileInfo">
              Email: <b id="profileEmail">not set</b><br/>
              Balance: <b><span id="profileBalance">0</span> UZS</b><br/>
              Notifications: <b><span id="notifCountMini">0</span> new</b>
            </div>

            <div class="profileActions">
              <button class="miniBtn" id="profileOpenSettings" type="button">Open settings</button>
              <button class="miniBtn primary" id="profileAddNotif" type="button">Demo notif</button>

              <!-- ‚úÖ Added: Logout (same style, no design change) -->
              <button class="miniBtn" id="logoutBtn" type="button">Logout</button>
            </div>
          </div>
        </div>
      </div>
    </header>

    <main class="cards">
      <article class="tile">
        <div class="tileBtn">
          <div class="inner"><div class="title">sefr speaking</div></div>
          <div class="priceBtn" data-name="sefr speaking" data-price="10000">10,000 UZS</div>
          <div class="sub">Fast speaking practice</div>
        </div>
      </article>

      <article class="tile">
        <div class="tileBtn">
          <div class="inner"><div class="title">writing test</div></div>
          <div class="priceBtn" data-name="writing test" data-price="5000">5,000 UZS</div>
          <div class="sub">Get feedback + score</div>
        </div>
      </article>

      <article class="tile">
        <div class="tileBtn">
          <div class="inner"><div class="title">ielts speaking</div></div>
          <div class="priceBtn" data-name="ielts speaking" data-price="50000">50,000 UZS</div>
          <div class="sub">Real IELTS-style speaking</div>
        </div>
      </article>
    </main>
  </div>

  <!-- SETTINGS PAGE -->
  <div class="backdrop" id="settingsBack"></div>
  <section class="settings" id="settingsPage" aria-label="Settings Page">
    <div class="settingsHead">
      <div class="settingsTitle">Settings</div>
      <button class="closeBtn" id="closeSettings" aria-label="Close">‚úï</button>
    </div>

    <div class="tabs">
      <button class="tab active" data-tab="account" type="button">Account</button>
      <button class="tab" data-tab="balance" type="button">Balance</button>
      <button class="tab" data-tab="transactions" type="button">Transactions</button>
      <button class="tab" data-tab="notifications" type="button">Notifications</button>
    </div>

    <!-- ACCOUNT -->
    <div class="panel show" id="panel-account">
      <div class="grid2">
        <div class="cardBox">
          <div style="font-weight:1000; margin-bottom:10px;">Account settings</div>

          <label for="nameInput">Name</label>
          <input id="nameInput" placeholder="Your name" />

          <div style="height:10px"></div>

          <label for="emailInput">Email for notifications</label>
          <input id="emailInput" placeholder="example@gmail.com" />

          <div style="height:10px"></div>
          <button class="btn" id="saveAccount" type="button">Save</button>

          <div style="height:10px"></div>
          <div class="mutedSmall">Saved locally (localStorage). Later connect real backend.</div>
        </div>

        <div class="cardBox">
          <div style="font-weight:1000; margin-bottom:10px;">Preview</div>
          <div style="font-size:14px; line-height:1.55;">
            Name: <b id="previewName">User</b><br/>
            Email: <b id="previewEmail">not set</b><br/>
            Balance: <b><span id="previewBalance">0</span> UZS</b><br/>
            New notifications: <b><span id="previewNotif">0</span></b>
          </div>
        </div>
      </div>
    </div>

    <!-- BALANCE -->
    <div class="panel" id="panel-balance">
      <div class="grid2">
        <div class="cardBox">
          <div style="font-weight:1000; margin-bottom:10px;">Current balance</div>
          <div style="font-size:32px; font-weight:1000;">
            <span id="balanceBig">0</span> <span style="font-size:14px; opacity:.75;">UZS</span>
          </div>

          <div style="height:10px"></div>
          <div class="mutedSmall">
            Deposit is done via <b>+</b> button (Click / Payme).<br/>
            Balance will change only after confirmation (later).
          </div>
        </div>

        <div class="cardBox">
          <div style="font-weight:1000; margin-bottom:10px;">Deposit statuses</div>
          <div class="mutedSmall">
            Real flow:
            <ul style="margin:8px 0 0 18px; padding:0; line-height:1.5;">
              <li>New deposit = <b>checking</b></li>
              <li>After payment confirm = <b>completed</b></li>
              <li>If cancelled/failed = <b>denied</b></li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- TRANSACTIONS -->
    <div class="panel" id="panel-transactions">
      <div class="cardBox" style="margin-bottom:12px;">
        <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between;">
          <div>
            <div style="font-weight:1000;">Transactions history</div>
            <div class="mutedSmall">Statuses: completed / checking / denied</div>
          </div>

          <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <select id="txStatus">
              <option value="completed">completed</option>
              <option value="checking">checking</option>
              <option value="denied">denied</option>
            </select>
            <button class="btn" id="addTxDemo" type="button">Add demo tx</button>
            <button class="btn" id="clearTx" type="button">Clear</button>
          </div>
        </div>
      </div>

      <div class="cardBox">
        <table class="txTable">
          <thead>
            <tr>
              <th>Date</th>
              <th>Type</th>
              <th>Amount</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="txBody"></tbody>
        </table>
        <div id="txEmpty" class="mutedSmall" style="padding:10px; display:none;">No transactions yet.</div>
      </div>
    </div>

    <!-- NOTIFICATIONS -->
    <div class="panel" id="panel-notifications">
      <div class="grid2">
        <div class="cardBox">
          <div style="font-weight:1000; margin-bottom:10px;">Notifications</div>
          <div class="mutedSmall">These are saved locally for demo.</div>

          <div style="height:10px"></div>
          <button class="btn" id="addNotif" type="button">Add demo notification</button>
          <div style="height:10px"></div>
          <button class="btn" id="markAllRead" type="button">Mark all read</button>
        </div>

        <div class="cardBox">
          <div style="font-weight:1000; margin-bottom:10px;">Unread count</div>
          <div style="font-size:30px; font-weight:1000;">
            <span id="notifCountBig">0</span>
          </div>
          <div class="mutedSmall">New notifications</div>
        </div>
      </div>
    </div>
  </section>

  <!-- CONFIRM PURCHASE -->
  <div class="confirmBack" id="confirmBack"></div>
  <div class="confirmBox" id="confirmBox" role="dialog" aria-modal="true">
    <div class="confirmTitle">Are you sure?</div>
    <div class="confirmText" id="confirmText"></div>
    <div class="confirmActions">
      <button class="btnSecondary" id="confirmCancel" type="button">Cancel</button>
      <button class="btnPrimary" id="confirmYes" type="button">Yes, buy</button>
    </div>
  </div>

  <!-- ‚úÖ DEPOSIT METHODS (Click / Payme) -->
  <div class="confirmBack" id="depositBack"></div>
  <div class="confirmBox" id="depositBox" role="dialog" aria-modal="true">
    <div class="confirmTitle">Choose deposit method</div>
    <div class="confirmText">Automated payment confirmation will be added later.</div>

    <div class="payGrid">
      <button class="payBtn click" type="button" data-method="Click">
        <span class="logoBox" aria-hidden="true">
          <svg width="34" height="34" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="6" y="6" width="36" height="36" rx="12" fill="rgba(26,167,255,.18)"/>
            <path d="M18 16h10c4.4 0 8 3.6 8 8s-3.6 8-8 8H18" stroke="#1aa7ff" stroke-width="3.6" stroke-linecap="round"/>
            <path d="M18 16v16" stroke="#b9ff1f" stroke-width="3.6" stroke-linecap="round"/>
          </svg>
        </span>
        <span class="payText">
          <span class="payName">Click</span>
          <span class="payHint">Create deposit (checking)</span>
        </span>
      </button>

      <button class="payBtn payme" type="button" data-method="Payme">
        <span class="logoBox" aria-hidden="true">
          <svg width="34" height="34" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="6" y="6" width="36" height="36" rx="12" fill="rgba(160,110,255,.16)"/>
            <path d="M17 30V18h9.5c3.6 0 6.5 2.7 6.5 6s-2.9 6-6.5 6H17Z"
                  stroke="rgba(160,110,255,1)" stroke-width="3.6" stroke-linejoin="round"/>
            <path d="M17 24h16" stroke="#b9ff1f" stroke-width="3.6" stroke-linecap="round"/>
          </svg>
        </span>
        <span class="payText">
          <span class="payName">Payme</span>
          <span class="payHint">Create deposit (checking)</span>
        </span>
      </button>
    </div>

    <div class="confirmActions">
      <button class="btnSecondary" id="depositCancel" type="button">Cancel</button>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    <script>
const API_BASE = ""; // later: https://api.yourdomain.com

    // ==============================
    // ‚úÖ ADDED #1: AUTH GUARD
    // ==============================
   // ===== AUTH GUARD (put at top) =====
if (localStorage.getItem("logged_in") !== "1") {
  window.location.replace("./index.html");
}


    // ===== Toast =====
    const toast = document.getElementById("toast");
    let toastTimer = null;
    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add("show");
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=> toast.classList.remove("show"), 1600);
    }

    // ===== Storage helpers =====
    function safeParse(key, fallback){
      try { return JSON.parse(localStorage.getItem(key) || JSON.stringify(fallback)); }
      catch { return fallback; }
    }
    function safeSave(key, value){
      localStorage.setItem(key, JSON.stringify(value));
    }

    // ==============================
    // ‚úÖ ADDED #2: LOAD USER FROM LOGIN
    // ==============================
    const loginPhone = localStorage.getItem("user_phone") || "";
    const loginSub = loginPhone ? `+998${loginPhone}` : "English learner";

    // ===== User (name/email) =====
    const nameInput = document.getElementById("nameInput");
    const emailInput = document.getElementById("emailInput");
    const saveAccount = document.getElementById("saveAccount");

    const profileName = document.getElementById("profileName");
    const profileSub  = document.getElementById("profileSub");
    const profileEmail = document.getElementById("profileEmail");
    const previewName = document.getElementById("previewName");
    const previewEmail = document.getElementById("previewEmail");

    function loadAccount(){
      const name = localStorage.getItem("user_name") || "User";
      const email = localStorage.getItem("user_email") || "";
      nameInput.value = name === "User" ? "" : name;
      emailInput.value = email;

      // ‚úÖ show phone in profile sub (from login)
      profileSub.textContent = loginSub;

      applyAccount(name, email);
      updateAvatarInitial(name);
    }

    function applyAccount(name, email){
      const n = (name && name.trim()) ? name.trim() : "User";
      const e = (email && email.trim()) ? email.trim() : "";
      profileName.textContent = n;
      profileEmail.textContent = e || "not set";
      previewName.textContent = n;
      previewEmail.textContent = e || "not set";
      localStorage.setItem("user_name", n);
      localStorage.setItem("user_email", e);

      // keep profileSub always phone
      profileSub.textContent = loginSub;

      updateAvatarInitial(n);
    }

    // ‚úÖ update the default avatar SVG letter to the first letter of name
    function updateAvatarInitial(name){
      const letter = (name && name.trim()) ? name.trim()[0].toUpperCase() : "A";
      const svg = `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120'%3E%3Crect width='120' height='120' rx='60' fill='%231aa7ff'/%3E%3Ctext x='50%25' y='56%25' text-anchor='middle' font-family='Arial' font-size='44' fill='%23b9ff1f' font-weight='800'%3E${encodeURIComponent(letter)}%3C/text%3E%3C/svg%3E`;
      const avatarImg = document.getElementById("avatarImg");
      if (avatarImg) avatarImg.src = svg;
      const profileImg = document.getElementById("profileImg");
      if (profileImg) profileImg.src = svg;
    }

    saveAccount.addEventListener("click", ()=>{
      applyAccount(nameInput.value, emailInput.value);
      showToast("‚úÖ Account saved");
    });
    loadAccount();

    // ===== Balance =====
    let balance = Number(localStorage.getItem("balance") || 0);
    const balanceValue = document.getElementById("balanceValue");
    const profileBalance = document.getElementById("profileBalance");
    const previewBalance = document.getElementById("previewBalance");
    const balanceBig = document.getElementById("balanceBig");

    function renderBalance(){
      const v = balance.toLocaleString("en-US");
      balanceValue.textContent = v;
      profileBalance.textContent = v;
      previewBalance.textContent = v;
      balanceBig.textContent = v;
      localStorage.setItem("balance", String(balance));
    }
    renderBalance();

    // ===== Transactions =====
    const txBody = document.getElementById("txBody");
    const txEmpty = document.getElementById("txEmpty");
    const txStatus = document.getElementById("txStatus");
    const addTxDemo = document.getElementById("addTxDemo");
    const clearTx = document.getElementById("clearTx");

    function loadTx(){ return safeParse("tx_list", []); }
    function saveTx(list){ safeSave("tx_list", list); }

    function formatDate(ts){
      const d = new Date(ts);
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth()+1).padStart(2,'0');
      const dd = String(d.getDate()).padStart(2,'0');
      const hh = String(d.getHours()).padStart(2,'0');
      const mi = String(d.getMinutes()).padStart(2,'0');
      return `${yyyy}-${mm}-${dd} ${hh}:${mi}`;
    }

    function statusPill(status){
      const cls = status === "completed" ? "completed" : status === "checking" ? "checking" : "denied";
      return `<span class="pill ${cls}">${status}</span>`;
    }

    function renderTx(){
      const list = loadTx();
      txBody.innerHTML = "";
      if (!list.length){
        txEmpty.style.display = "block";
        return;
      }
      txEmpty.style.display = "none";
      list.slice().reverse().forEach(tx=>{
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${formatDate(tx.ts)}</td>
          <td>${escapeHtml(tx.type)}</td>
          <td>${tx.amount === 0 ? "-" : (tx.amount > 0 ? "+" : "-")}${Math.abs(tx.amount).toLocaleString("en-US")} UZS</td>
          <td>${statusPill(tx.status)}</td>
        `;
        txBody.appendChild(tr);
      });
    }

    function addTransaction(type, amount, status){
      const list = loadTx();
      list.push({ ts: Date.now(), type, amount, status });
      saveTx(list);
      renderTx();
    }

    addTxDemo.addEventListener("click", ()=>{
      const st = txStatus.value;
      const amt = st === "denied" ? 0 : (st === "checking" ? 15000 : 25000);
      addTransaction("new transaction", amt, st);
      showToast("‚úÖ Demo transaction added");
    });

    clearTx.addEventListener("click", ()=>{
      saveTx([]);
      renderTx();
      showToast("üóëÔ∏è Transactions cleared");
    });

    renderTx();

    // ===== Notifications =====
    const notifCountMini = document.getElementById("notifCountMini");
    const notifCountBig = document.getElementById("notifCountBig");
    const previewNotif = document.getElementById("previewNotif");

    function loadNotifs(){ return safeParse("notifs", []); }
    function saveNotifs(list){ safeSave("notifs", list); }

    function unreadCount(){
      return loadNotifs().filter(n => !n.read).length;
    }

    function updateNotifCounts(){
      const u = unreadCount();
      notifCountMini.textContent = u;
      notifCountBig.textContent = u;
      previewNotif.textContent = u;
    }

    function pushNotif(text){
      const list = loadNotifs();
      list.push({ id: randId(), ts: Date.now(), text, read: false });
      saveNotifs(list);
      updateNotifCounts();
    }

    document.getElementById("addNotif").addEventListener("click", ()=>{
      pushNotif("Your service request is being checked (demo).");
      showToast("üîî Notification added");
    });

    document.getElementById("markAllRead").addEventListener("click", ()=>{
      const list = loadNotifs().map(n => ({...n, read:true}));
      saveNotifs(list);
      updateNotifCounts();
      showToast("‚úÖ All read");
    });

    document.getElementById("profileAddNotif").addEventListener("click", ()=>{
      pushNotif("Completed: demo notification.");
      showToast("üîî Demo notification added");
    });

    if (!localStorage.getItem("seed_notifs2")){
      pushNotif("Welcome! Notifications are enabled.");
      localStorage.setItem("seed_notifs2","1");
    } else {
      updateNotifCounts();
    }

    // ===== Profile popup =====
    const avatarBtn = document.getElementById("avatarBtn");
    const profileCard = document.getElementById("profileCard");

    avatarBtn.addEventListener("click", (e)=>{
      e.stopPropagation();
      profileCard.classList.toggle("show");
    });
    document.addEventListener("click", ()=> profileCard.classList.remove("show"));
    profileCard.addEventListener("click", (e)=> e.stopPropagation());

    // ==============================
    // ‚úÖ ADDED #3: LOGOUT BUTTON
    // ==============================
    const logoutBtn = document.getElementById("logoutBtn");
    logoutBtn.addEventListener("click", ()=>{
      localStorage.removeItem("logged_in");
      // keep user info if you want, or remove it too:
      // localStorage.removeItem("user_phone");
      // localStorage.removeItem("user_name");
      // localStorage.removeItem("user_email");
       window.location.replace("./index.html");
    });

    // ===== Settings open/close =====
    const openSettings = document.getElementById("openSettings");
    const settingsBack = document.getElementById("settingsBack");
    const settingsPage = document.getElementById("settingsPage");
    const closeSettings = document.getElementById("closeSettings");
    const profileOpenSettings = document.getElementById("profileOpenSettings");

    function showSettings(){
      settingsBack.classList.add("show");
      settingsPage.classList.add("show");
      profileCard.classList.remove("show");
    }
    function hideSettings(){
      settingsBack.classList.remove("show");
      settingsPage.classList.remove("show");
    }

    openSettings.addEventListener("click", showSettings);
    profileOpenSettings.addEventListener("click", showSettings);
    closeSettings.addEventListener("click", hideSettings);
    settingsBack.addEventListener("click", hideSettings);

    // Tabs
    const tabs = document.querySelectorAll(".tab");
    const panels = {
      account: document.getElementById("panel-account"),
      balance: document.getElementById("panel-balance"),
      transactions: document.getElementById("panel-transactions"),
      notifications: document.getElementById("panel-notifications"),
    };
    function setTab(name){
      tabs.forEach(t => t.classList.toggle("active", t.dataset.tab === name));
      Object.keys(panels).forEach(k => panels[k].classList.toggle("show", k === name));
    }
    tabs.forEach(t => t.addEventListener("click", ()=> setTab(t.dataset.tab)));

    // ===== Purchase confirm flow =====
    const confirmBack = document.getElementById("confirmBack");
    const confirmBox = document.getElementById("confirmBox");
    const confirmText = document.getElementById("confirmText");
    const confirmCancel = document.getElementById("confirmCancel");
    const confirmYes = document.getElementById("confirmYes");

    let pendingPurchase = null;

    function openConfirm({name, price}){
      pendingPurchase = { name, price };
      confirmText.textContent = `Buy "${name}" for ${price.toLocaleString("en-US")} UZS?`;
      confirmBack.classList.add("show");
      confirmBox.classList.add("show");
    }
    function closeConfirm(){
      confirmBack.classList.remove("show");
      confirmBox.classList.remove("show");
      pendingPurchase = null;
    }

    confirmCancel.addEventListener("click", closeConfirm);
    confirmBack.addEventListener("click", closeConfirm);

    document.querySelectorAll(".priceBtn").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const name = btn.dataset.name;
        const price = Number(btn.dataset.price || 0);
        openConfirm({name, price});
      });
    });

    confirmYes.addEventListener("click", ()=>{
      if (!pendingPurchase) return;
      const { name, price } = pendingPurchase;

      if (balance >= price){
        balance -= price;
        renderBalance();

        addTransaction(name, price, "completed");
        pushNotif(`Completed: ${name} (-${price.toLocaleString("en-US")} UZS)`);
        showToast(`‚úÖ Purchased: ${name}`);
      } else {
        const need = price - balance;
        addTransaction(name, 0, "denied");
        pushNotif(`Denied: ${name} (need +${need.toLocaleString("en-US")} UZS)`);
        showToast(`‚ùå Not enough balance. Need +${need.toLocaleString("en-US")} UZS`);
      }

      closeConfirm();
    });

    // ===== Deposit Methods (Click / Payme) =====
    const depositBack = document.getElementById("depositBack");
    const depositBox = document.getElementById("depositBox");
    const depositCancel = document.getElementById("depositCancel");

    function openDeposit(){
      depositBack.classList.add("show");
      depositBox.classList.add("show");
    }
    function closeDeposit(){
      depositBack.classList.remove("show");
      depositBox.classList.remove("show");
    }

    document.getElementById("addFunds").addEventListener("click", openDeposit);
    depositCancel.addEventListener("click", closeDeposit);
    depositBack.addEventListener("click", closeDeposit);

    document.querySelectorAll(".payBtn").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const method = btn.dataset.method;

        addTransaction(`deposit via ${method}`, 0, "checking");
        pushNotif(`Deposit via ${method} created. Waiting for confirmation.`);
        showToast(`‚è≥ ${method}: waiting confirmation`);

        closeDeposit();
      });
    });

    // ===== keep preview up to date =====
    function renderPreview(){
      updateNotifCounts();
      renderBalance();
    }
    renderPreview();

    // ===== util =====
    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
    function randId(){
      return Math.random().toString(16).slice(2) + Date.now().toString(16);
    }
    
  </script>
</body>
</html>
